DROP DATABASE IF EXISTS legacy_escolar;
CREATE DATABASE legacy_escolar CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE legacy_escolar;

-- tablas

CREATE TABLE carreras (
  clave CHAR(2) NOT NULL,
  nombre VARCHAR(120) NOT NULL,
  fecalt DATE NULL,
  fecbaj DATE NULL,
  PRIMARY KEY (clave)
) ENGINE=InnoDB;

CREATE TABLE materias (
  clave INT NOT NULL,
  descri VARCHAR(120) NOT NULL,
  nsesio TINYINT UNSIGNED NULL,
  durses DECIMAL(4,1) NULL,
  taller BOOLEAN NULL,
  fecalt DATE NULL,
  fecbaj DATE NULL,
  tipo CHAR(1) NULL,
  PRIMARY KEY (clave)
) ENGINE=InnoDB;

CREATE TABLE planes (
  id INT NOT NULL AUTO_INCREMENT,
  carrer CHAR(2) NOT NULL,
  materi INT NOT NULL,
  semest CHAR(2) NOT NULL,
  fecalt DATE NULL,
  fecbaj DATE NULL,
  PRIMARY KEY (id),
  UNIQUE KEY uq_planes (carrer, materi, semest),
  CONSTRAINT fk_planes_carrera FOREIGN KEY (carrer)
    REFERENCES carreras(clave)
    ON UPDATE CASCADE ON DELETE RESTRICT
) ENGINE=InnoDB;

-- carreras
INSERT INTO carreras (clave, nombre, fecalt, fecbaj) VALUES
('05','ING. EN SIST COMPUTACIONALES EN SOFTWARE','1990-07-20',NULL),
('07','ING. EN SIST COMPUTACIONALES EN HARDWARE','1995-03-06',NULL);

-- materias
INSERT INTO materias (clave, descri, nsesio, durses, taller, fecalt, fecbaj, tipo) VALUES
(101,'ALGEBRA SUPERIOR',4,1.0,NULL,'1982-06-18',NULL,'L'),
(102,'MATEMATICAS I',5,1.0,NULL,'1982-06-18',NULL,'L'),
(103,'FISICA I',4,1.0,NULL,'1982-06-18',NULL,'L'),
(105,'INTRODUCCION A LA INGENIERIA',2,1.0,NULL,'1982-06-18',NULL,'L'),
(106,'DIBUJO',3,1.0,NULL,'1982-06-18',NULL,'L'),
(107,'TOPOGRAFIA I',4,1.0,NULL,'1983-01-27',NULL,'L'),
(108,'PRACTICAS DE TOPOGRAFIA I',4,1.0,NULL,'1983-01-27',NULL,'L'),
(140,'INTRODUCCION A LA COMPUTACION',3,1.0,NULL,'1990-07-20',NULL,'L'),
(141,'INGLES I',3,1.0,NULL,'1990-07-20',NULL,'L'),
(142,'INTRODUCCION A LA INFORMATICA',3,1.0,NULL,'1990-07-20',NULL,'L'),
(150,'FUNDAMENTOS DE QUIMICA',2,1.0,NULL,'1982-08-31',NULL,'L'),
(151,'INGLES',2,1.0,NULL,'1982-08-31','1995-01-06','L'),
(152,'SEMINARIO',2,1.0,NULL,'1982-08-31','1995-01-06','L'),
(201,'MATEMATICAS II',5,1.0,NULL,'1982-06-18',NULL,'L'),
(202,'FISICA II',3,1.0,NULL,'1982-06-18',NULL,'L'),
(203,'ALGEBRA LINEAL',4,1.0,NULL,'1982-06-18',NULL,'L'),
(204,'TOPOGRAFIA',4,1.0,NULL,'1982-06-18','1995-01-06','L'),
(206,'ADMINISTRACION',2,1.0,NULL,'1982-06-28',NULL,'L'),
(207,'INFORMACION CARTOGRAFICA',2,1.0,NULL,'1982-06-18','1995-01-06','L'),
(208,'PRACTICAS DE TOPOGRAFIA',4,1.0,NULL,'1982-06-18','1995-01-06','L'),
(209,'PROGRAMACION I',4,1.0,NULL,'1983-08-08',NULL,'L'),
(210,'TOPOGRAFIA II',4,1.0,NULL,'1983-08-08',NULL,'L'),
(211,'PRACTICAS DE TOPOGRAFIA II',4,1.0,NULL,'1983-08-08',NULL,'L'),
(241,'INGLES II',3,1.0,NULL,'1990-07-20',NULL,'L'),
(250,'QUIMICA II',3,1.0,NULL,'1982-08-03','1995-01-06','L'),
(251,'GEOLOGIA FISICA I-A',3,1.0,NULL,'1982-08-03','1995-01-06','L'),
(252,'ANALISIS CUALITATIVO',4,1.0,NULL,'1982-08-31','1995-01-06','L'),
(255,'ANALISIS QUIMICO CUALITATIVO',3,1.0,NULL,'1982-08-31','1995-01-06','L'),
(256,'LAB. ANALISIS QUIMICO CUALITATIVO',2,1.0,NULL,'1982-08-31','1995-01-06','L'),
(270,'GEOLOGIA FISICA I',3,1.0,NULL,'1982-08-31','1995-01-06','L'),
(271,'PRACTICAS GEOLOGIA FISICA I',2,1.0,NULL,'1982-08-31','1995-01-06','L');

-- planes
INSERT INTO planes (carrer, materi, semest, fecalt)
VALUES
('05',101,'01','1982-06-24'),
('05',102,'01','1982-06-25'),
('05',103,'01','1982-06-24'),
('05',201,'02','1982-06-28'),
('05',202,'02','1982-06-28'),
('05',203,'02','1982-06-28'),
('07',105,'01','1982-06-28'),
('07',106,'01','1982-06-28'),
('07',204,'02','1982-06-28'),
('07',206,'02','1982-06-28'),
('07',207,'02','1982-06-28'),
('07',208,'02','1982-06-28');

-- vista
CREATE OR REPLACE VIEW v_planes_detalle AS
SELECT
  p.id,
  p.carrer,
  c.nombre AS carrera_nombre,
  p.semest,
  p.materi,
  m.descri AS materia_nombre,
  p.fecalt,
  p.fecbaj
FROM planes p
LEFT JOIN carreras c ON c.clave = p.carrer
LEFT JOIN materias m ON m.clave = p.materi
ORDER BY p.carrer, p.semest, p.materi;
